# PWA «Маршруты инженера» (CRA + TypeScript)

Шаблон на Create React App с PWA, Tailwind, локальным сохранением, экспортом в Excel и отправкой на сервер.

## Возможности
- Главная: дата, календарь (справа сверху), список адресов дня (первый и последний — «Алушта, ул. Снежковой 17Б»), кнопка «Отправить»
- Поля точки: Адрес, Название ИП, TID, Причина выезда
- Автосохранение в `localStorage` при вводе (с дебаунсом 200мс)
- Экспорт в Excel по диапазону дат
- PWA: офлайн-кэш, подсказка установики на iOS
- Адаптивная светлая/тёмная темы, Tailwind
- Отправка на сервер `POST REACT_APP_API_URL` через axios

## Быстрый старт
```bash
npm i
cp .env.sample .env      # при необходимости поменяйте REACT_APP_API_URL
npm start
```

Сборка:
```bash
npm run build
```

## Настройки
- `.env` — укажите `REACT_APP_API_URL=https://api.lumastack.ru/routes.json`
- Иконки: `public/icons/icon-192.png`, `public/icons/icon-512.png`
- Цвет акцента: #0C61FD

## Замечание по Face ID
Face ID (WebAuthn) в PWA требует серверных endpoint’ов для генерации/проверки challenge. В этом шаблоне оставлен только локальный PIN-замок как будущая опция. Могу добавить минимальный сервер позже.

## Расчёт дистанции
Используется модуль `src/services/routing.ts`:
- Если задан `REACT_APP_ORS_KEY` — геокодинг и маршрутизация через **OpenRouteService** (рекомендуется).
- Иначе: геокодинг через **Nominatim** (OSM) и маршрутизация через публичный **OSRM** (`REACT_APP_OSRM_URL`, по умолчанию `https://router.project-osrm.org`).

### Где взять токен ORS
1. Зарегистрируйтесь на https://openrouteservice.org/dev/#/signup
2. Создайте API Key и поместите в `.env`:
```
REACT_APP_ORS_KEY=ваш_ключ
```
Опционально можно переопределить эндпоинты:
```
REACT_APP_OSRM_URL=https://router.project-osrm.org
REACT_APP_NOMINATIM_URL=https://nominatim.openstreetmap.org
```

## Настройки
Страница **Настройки** позволяет задать стартовый и финишный адрес офиса (применяются для новых дней; на текущий день — кнопка «Обновить офисы» на главной) и управлять шаблонами «Причина выезда».

## Экспорт
Страница **Экспорт** показывает таблицу за диапазон дат и позволяет скачать **CSV** или **Excel**.

## Фоновая синхронизация и ретраи
- При неудачной отправке день ставится в локальную очередь.
- При появлении сети или событии Background Sync (`sync`) сервис-воркер отправляет `postMessage` клиентам, и приложение пробует отправить очередь.
- Также повторная отправка запускается на событие `online`.

## Бэкап/импорт (опционально)
В «Настройках» можно скачать локальный JSON (дни+настройки+кеш геокодинга) и импортировать обратно. Это полезно для переноса на новое устройство или если сервер не хранит полную историю локальных правок.

## Цветовые теги причин
В «Настройках» задаются причины с цветами. На карточке точки чипы подсвечиваются этим цветом; при выборе причины показывается цветная точка рядом с полем.

## Окружение (.env.local)
Используйте файл `.env.local` (приватный для машины разработчика). В репозитории есть шаблон `.env.local.sample`.
Скопируйте:
```
cp .env.local.sample .env.local
```
и при необходимости заполните переменные.

### Локализация календаря
Используется `react-day-picker` + `date-fns/locale/ru`. Если не установилось автоматически, поставь:
```
npm i date-fns
```
